---
- name: Build contracts
  cisco.aci.aci_contract:
    tenant: "{{ tenant_info.name }}"
    description: "{{ current_contract.description | default() }}"  # <TODO> Omit this parameter if no description is present
    contract: "{{ current_contract.name }}"
    state: "{{ global_object_state }}"

- name: Create contract subjects for filters
  cisco.aci.aci_contract_subject:
    tenant: "{{ tenant_info.name }}"
    description: "{{ current_contract.description }}"  # <TODO> Omit this parameter if no description is present
    contract: # <TODO> Use a variable to populate the contract name
    subject: "{{ current_contract.subject }}"
    state: "{{ global_object_state }}"

- name: Add filters to contract subjects
  cisco.aci.aci_contract_subject_to_filter:
    tenant: "{{ tenant_info.name }}"
    subject: "{{ current_contract.subject }}"
    contract: "{{ current_contract.name }}"
    filter: # <TODO> Use a variable to populate the contract filter name
    state: "{{ global_object_state }}"

- name: Associate EPGs with contracts
  cisco.aci.aci_epg_to_contract:
    tenant: "{{ tenant_info.name }}"
    ap: "{{ current_contract.app_profile }}"
    contract: "{{ current_contract.name }}"
    epg: # <TODO> Use a loop variable to populate the name of the EPG to associate
    contract_type: "{{ item.direction }}"
    state: "{{ global_object_state }}"
  loop: "{{ current_contract.contract_to_epg | default([]) }}"
  when:
    - item.epg_name is defined
